# Настройка Apache Airflow с использованием Docker Compose

Этот репозиторий предоставляет настройку Docker Compose для развертывания Apache Airflow с использованием PostgreSQL.

## Обзор

Файл `docker-compose.yml` определяет три сервиса: `init`, `webserver` и `db`. Каждый сервис имеет свои собственные настройки и зависимости.

### Сервисы

#### 1. init
- **Назначение**: Инициализация базы данных Airflow.
- **Image**: Использует образ, указанный в переменной окружения `${AIRFLOW_IMAGE_NAME}`.
- **Имя контейнера**: `airflow_init`.
- **Зависимости**: Запускается после запуска сервиса `db`.
- **Переменные окружения**: Настраивает подключение к базе данных PostgreSQL с использованием переменных `${POSTGRES_USER}`, `${POSTGRES_PASSWORD}`, `${POSTGRES_PORT}`, `${POSTGRES_DB}`.
- **Entrypoint**: Выполняет команду `airflow db init` для инициализации базы данных.

#### 2. webserver
- **Назначение**: Запуск веб-сервера Airflow.
- **Image**: Использует образ, указанный в переменной окружения `${AIRFLOW_IMAGE_NAME}`.
- **Имя контейнера**: `airflow_webserver`.
- **Переменные окружения**: Настраивает подключение к базе данных PostgreSQL с использованием переменных `${POSTGRES_USER}`, `${POSTGRES_PASSWORD}`, `${POSTGRES_PORT}`, `${POSTGRES_DB}`.
- **Порты**: Прокидывает порт `8080` наружу для доступа к веб-интерфейсу Airflow.
- **Зависимости**: Запускается после запуска сервиса `db`.
- **volumes**: Монтирует локальную директорию `./dags` в контейнер по пути `/opt/airflow/dags`.
- **Команда**: Запускает команду `airflow webserver --port 8080`.
- **Healthcheck**: Проверяет доступность веб-сервера, выполняя команду `curl -f http://localhost:8080/health` с интервалом 30 секунд, таймаутом 10 секунд и 5 попытками.

#### 3. db
- **Назначение**: Запуск базы данных PostgreSQL.
- **Image**: Использует официальный образ `postgres:13`.
- **Имя контейнера**: `postgres_db`.
- **Переменные окружения**: Настраивает пользователя, пароль и базу данных с использованием переменных `${POSTGRES_USER}`, `${POSTGRES_PASSWORD}`, `${POSTGRES_DB}`.
- **volumes**: Монтирует Docker volume `postgres_data` для сохранения данных PostgreSQL.
- **Healthcheck**: Проверяет доступность базы данных с помощью команды `pg_isready -U ${POSTGRES_USER}` с интервалом 30 секунд, таймаутом 10 секунд и 5 попытками.

### Тома
- **postgres_data**: Docker volume для хранения данных PostgreSQL.

### Сети
- **default**: Создает сеть с именем `airflow_network` для связи между контейнерами.

Можно ли ограничивать ресурсы (например, память или CPU) для сервисов в docker-compose.yml? Если нет, то почему, если да, то как?
Да, в Docker Compose можно ограничивать ресурсы (например, память или CPU) для сервисов. Это делается с помощью параметров resources, mem_limit, cpus и других. 

Как можно запустить только определенный сервис из docker-compose.yml, не запуская остальные?
Для запуска только определенного сервиса из docker-compose.yml можно использовать команду docker-compose up [name], например docker-compose up webserver


